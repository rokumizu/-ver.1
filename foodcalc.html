<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ „é¤Šã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ã‚½ãƒ•ãƒˆ</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4faff;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #0077cc;
      margin-bottom: 20px;
    }
    .grid {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .category {
      flex: 1;
      min-width: 250px;
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .category h2 {
      text-align: center;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      margin-bottom: 15px;
    }
    .card {
      margin-bottom: 15px;
    }
    .card label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .card input {
      width: 100%;
      padding: 5px;
      font-size: 16px;
    }
    .result {
      font-size: 14px;
      margin-top: 5px;
      background: #eef;
      padding: 5px;
      border-radius: 6px;
    }
    .summary, .warning, #target {
      text-align: center;
      margin-top: 20px;
      font-size: 16px;
    }
    .warning {
      color: red;
      font-weight: bold;
      white-space: pre-line;
    }
    .controls {
      max-width: 500px;
      margin: 0 auto 20px;
      text-align: center;
    }
    .controls select {
      padding: 8px;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <h1>ğŸ± æ „é¤Šã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ã‚½ãƒ•ãƒˆ</h1>

  <div class="controls">
    <label for="userSelect">ğŸ¯ PFCç›®æ¨™ã‚’é¸æŠ:</label>
    <select id="userSelect">
      <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    </select>
  </div>

  <!-- ğŸ¯ ç›®æ¨™è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
  <div id="target">ğŸ¯ ç›®æ¨™æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼: 0 kcalï½œP: 0 gï½œF: 0 gï½œC: 0 g</div>

  <div class="grid">
    <div class="category">
      <h2>ä¸»é£Ÿ</h2>
      <div class="card"><label>ãŠç±³</label><input type="number" data-name="ãŠç±³" data-cal="1.68" data-p="0.026" data-f="0.003" data-c="0.37"></div>
      <div class="card"><label>å°éº¦ç²‰</label><input type="number" data-name="å°éº¦ç²‰" data-cal="3.64" data-p="0.1" data-f="0.01" data-c="0.76"></div>
      <div class="card"><label>ãã°</label><input type="number" data-name="ãã°" data-cal="1.3" data-p="0.04" data-f="0.01" data-c="0.27"></div>
      <div class="card"><label>ã†ã©ã‚“</label><input type="number" data-name="ã†ã©ã‚“" data-cal="1.05" data-p="0.02" data-f="0.003" data-c="0.21"></div>
    </div>

    <div class="category">
      <h2>è‚‰ãƒ»é­š</h2>
      <div class="card"><label>é¶ã‚€ã­è‚‰</label><input type="number" data-name="é¶ã‚€ã­è‚‰" data-cal="1.65" data-p="0.2" data-f="0.03" data-c="0.0"></div>
      <div class="card"><label>ç‰›è‚‰</label><input type="number" data-name="ç‰›è‚‰" data-cal="2.9" data-p="0.15" data-f="0.23" data-c="0.0"></div>
      <div class="card"><label>é®­</label><input type="number" data-name="é®­" data-cal="2.0" data-p="0.22" data-f="0.1" data-c="0.0"></div>
    </div>

    <div class="category">
      <h2>æ²¹</h2>
      <div class="card"><label>ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«</label><input type="number" data-name="ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«" data-cal="9.0" data-p="0.0" data-f="1.0" data-c="0.0"></div>
    </div>
  </div>

  <div class="summary" id="summary">
    âœ… ç·æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼: 0 kcalï½œP: 0 gï½œF: 0 gï½œC: 0 g
  </div>
  <div class="warning" id="warning"></div>

  <script>
    let targets = { protein: 120, fat: 50, carb: 200 };

    function updateSummary() {
      let totalCal = 0, totalP = 0, totalF = 0, totalC = 0;

      document.querySelectorAll('.card').forEach(card => {
        const input = card.querySelector('input');
        const result = card.querySelector('.result') || (() => {
          const r = document.createElement("div");
          r.className = "result";
          card.appendChild(r);
          return r;
        })();
        const gram = parseFloat(input.value) || 0;
        const cal = parseFloat(input.dataset.cal);
        const p = parseFloat(input.dataset.p);
        const f = parseFloat(input.dataset.f);
        const c = parseFloat(input.dataset.c);

        const kcal = gram * cal;
        const prot = gram * p;
        const fat = gram * f;
        const carb = gram * c;

        result.textContent = `ã“ã®å“ç›®: ${kcal.toFixed(2)} kcalï½œP: ${prot.toFixed(2)}ï½œF: ${fat.toFixed(2)}ï½œC: ${carb.toFixed(2)}`;

        totalCal += kcal;
        totalP += prot;
        totalF += fat;
        totalC += carb;
      });

      document.getElementById("summary").textContent =
        `âœ… ç·æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼: ${totalCal.toFixed(2)} kcalï½œP: ${totalP.toFixed(2)} gï½œF: ${totalF.toFixed(2)} gï½œC: ${totalC.toFixed(2)} g`;

      let warning = "";
      if (totalP > targets.protein) warning += `âš  ã‚¿ãƒ³ãƒ‘ã‚¯è³ªãŒ ${(totalP - targets.protein).toFixed(2)} g ã‚ªãƒ¼ãƒãƒ¼\n`;
      if (totalF > targets.fat) warning += `âš  è„‚è³ªãŒ ${(totalF - targets.fat).toFixed(2)} g ã‚ªãƒ¼ãƒãƒ¼\n`;
      if (totalC > targets.carb) warning += `âš  ç‚­æ°´åŒ–ç‰©ãŒ ${(totalC - targets.carb).toFixed(2)} g ã‚ªãƒ¼ãƒãƒ¼`;

      document.getElementById("warning").textContent = warning;
    }

    function updateUserSelect() {
      const users = JSON.parse(localStorage.getItem("pfcAllUsers") || "{}");
      const select = document.getElementById("userSelect");
      Object.keys(users).forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });
    }

    document.getElementById("userSelect").addEventListener("change", function () {
      const selected = this.value;
      const users = JSON.parse(localStorage.getItem("pfcAllUsers") || "{}");
      if (users[selected]) {
        const d = users[selected];
        targets.protein = d.proteinAvg;
        targets.fat = d.fatGram;
        targets.carb = d.carbGram;

        document.getElementById("target").textContent =
          `ğŸ¯ ç›®æ¨™æ‘‚å–ã‚«ãƒ­ãƒªãƒ¼: ${d.intake.toFixed(2)} kcalï½œP: ${d.proteinAvg.toFixed(2)} gï½œF: ${d.fatGram.toFixed(2)} gï½œC: ${d.carbGram.toFixed(2)} g`;

        updateSummary();
        alert(`ğŸ¯ ${selected} ã•ã‚“ã®ç›®æ¨™å€¤ã«è¨­å®šã•ã‚Œã¾ã—ãŸï¼`);
      }
    });

    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener("input", updateSummary);
    });

    updateUserSelect();
    updateSummary();
  </script>

</body>
</html>
